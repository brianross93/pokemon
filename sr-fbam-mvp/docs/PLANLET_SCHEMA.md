# Planlet JSON Schema (v0.1)

Planlets describe compact tactical plans generated by the search-enabled LLM
for System-1 execution and distillation. They are immutable once issued and
should be stored verbatim with telemetry logs.

## Top-level shape

```json
{
  "planlet_id": "pl_2025-10-21_1234",
  "seed_frame_id": 2187,
  "format": "gen9ou",
  "side": "p1",
  "horizon_steps": 3,
  "goal": "Secure speed control and chip opposing Dragonite into Ice Shard range.",
  "rationale": "Opp side lacks hazard removal; exploit SR + Rough Skin.",
  "preconditions": [
    "Our Landorus-T HP >= 60%",
    "Stealth Rock not set on opponent side"
  ],
  "script": [
    {
      "op": "SET_HAZARD",
      "actor": "Landorus-Therian",
      "hazard": "Stealth Rock",
      "fallback": {"op": "ATTACK", "move": "U-turn", "target": "opponent_active"}
    },
    {
      "op": "STATUS",
      "actor": "Rotom-Wash",
      "move": "Thunder Wave",
      "target": "Dragonite"
    },
    {
      "op": "BRING_IN",
      "actor": "Weavile",
      "method": "hard_switch"
    },
    {
      "op": "ATTACK",
      "actor": "Weavile",
      "move": "Ice Shard",
      "target": "Dragonite",
      "trigger": "Dragonite HP <= 40% or status == PAR"
    }
  ],
  "constraints": [
    "Avoid Terastallizing before endgame",
    "Preserve Weavile HP >= 50%"
  ],
  "retrieved_docs": [
    {"source": "usage_stats", "snippet": "Dragonite common sets: Multiscale + DD"},
    {"source": "calc", "snippet": "SR + Rough Skin -> Ice Shard KO"}
  ],
  "confidence": 0.71,
  "risk_notes": "If they reveal Heavy-Duty Boots + Defog, abort after step 1",
  "metadata": {
    "llm_model": "gpt-5",
    "search_calls": 2,
    "generated_at": "2025-10-21T03:31:27Z"
  }
}
```

## Script operations

| `op`          | Required keys                                   | Description                               |
|---------------|--------------------------------------------------|-------------------------------------------|
| `SET_HAZARD`  | `actor`, `hazard`                                | Set hazards (Spikes, Stealth Rock, etc.)  |
| `STATUS`      | `actor`, `move`, `target`                        | Inflict status via move ability           |
| `ATTACK`      | `actor`, `move`, optional `target`, `trigger`    | Offensive move usage                      |
| `TERASTALLIZE`| `actor`, `tera_type`, optional `followup`        | Perform Terastallization                  |
| `BRING_IN`    | `actor`, `method` (hard_switch, pivot, sack)     | Activate a benched Pok√©mon                |
| `PIVOT`       | `actor`, `move`, `target`                        | U-turn / Volt Switch style pivot          |
| `SCOUT`       | `actor`, `information_goal`                      | Encourage a reconnaissance action         |
| `ABORT`       | optional message                                 | Early termination directive               |

Fallback blocks are optional and use the same schema recursively.

## JSON Schema

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Planlet",
  "type": "object",
  "required": ["planlet_id", "seed_frame_id", "format", "side", "goal", "script"],
  "properties": {
    "planlet_id": {"type": "string"},
    "seed_frame_id": {"type": "integer"},
    "format": {"type": "string"},
    "side": {"enum": ["p1", "p2"]},
    "horizon_steps": {"type": "integer", "minimum": 1},
    "goal": {"type": "string"},
    "rationale": {"type": "string"},
    "preconditions": {"type": "array", "items": {"type": "string"}},
    "script": {
      "type": "array",
      "minItems": 1,
      "items": {"$ref": "#/definitions/script_step"}
    },
    "constraints": {"type": "array", "items": {"type": "string"}},
    "retrieved_docs": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["source", "snippet"],
        "properties": {
          "source": {"type": "string"},
          "snippet": {"type": "string"},
          "url": {"type": "string"}
        }
      }
    },
    "confidence": {"type": "number", "minimum": 0.0, "maximum": 1.0},
    "risk_notes": {"type": "string"},
    "metadata": {"type": "object"}
  },
  "definitions": {
    "script_step": {
      "type": "object",
      "required": ["op"],
      "properties": {
        "op": {"type": "string"},
        "actor": {"type": "string"},
        "move": {"type": "string"},
        "target": {"type": "string"},
        "hazard": {"type": "string"},
        "tera_type": {"type": "string"},
        "method": {"type": "string"},
        "trigger": {"type": "string"},
        "information_goal": {"type": "string"},
        "fallback": {"$ref": "#/definitions/script_step"}
      }
    }
  },
  "additionalProperties": false
}
```

This schema should be loaded in the planlet generator to validate LLM output
before execution or logging.
