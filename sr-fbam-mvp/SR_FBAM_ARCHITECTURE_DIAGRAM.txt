SR-FBAM Architecture Diagram
============================

┌─────────────────────────────────────────────────────────────────┐
│                        INPUT LAYER                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ Code Frame  │  │ Game Frame  │  │ ASCII Grid  │            │
│  │ (40x120)    │  │ (PyBoy)     │  │ + Features │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    TRANSFORMER ENCODER                          │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              Intra-Frame Processing                     │    │
│  │  • Multi-Head Self-Attention                          │    │
│  │  • Position Encoding                                  │    │
│  │  • Feed-Forward Networks                             │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                 TRANSFORMER SYMBOL EXTRACTOR                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              Learned Symbol Extraction                  │    │
│  │  • Importance Scoring                                  │    │
│  │  • Top-K Selection                                     │    │
│  │  • Symbol Embeddings                                  │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      SELECTIVE GATING                           │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              ExtractionGate (MLP)                      │    │
│  │  • Gate Score Calculation                              │    │
│  │  • ENCODE vs ASSOC Decision                           │    │
│  │  • Hindsight Supervision                              │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    SYMBOLIC MEMORY                              │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              Sparse, Associative Storage               │    │
│  │  • O(1) Hash Lookups                                  │    │
│  │  • Entity Relationships                              │    │
│  │  • Discrete Operations: ASSOC, FOLLOW, WRITE, HALT  │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                   MEMORY CROSS-ATTENTION                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              Current ↔ Historical                      │    │
│  │  • Multi-Head Cross-Attention                        │    │
│  │  • Contextual Symbol Matching                        │    │
│  │  • Attention Weights                                 │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      LSTM INTEGRATOR                           │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              Temporal State Management                 │    │
│  │  • Hidden State Update                               │    │
│  │  • Recurrence-Completeness                           │    │
│  │  • Frame + Symbols + Memory Integration              │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    POLICY VOCABULARY                            │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              Unified Action Surface                     │    │
│  │  • Memory Operations: ASSOC, FOLLOW, WRITE, HALT     │    │
│  │  • Environment Actions: UP, DOWN, A, B, etc.         │    │
│  │  • Interleaved Token Generation                       │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      LLM INTEGRATION                            │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              GPT-5 High-Level Reasoning                  │    │
│  │  • Asynchronous Plan Generation                         │    │
│  │  • Strategic Decision Making                           │    │
│  │  • HALT Operation Handler                              │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      OUTPUT LAYER                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ Code Edit   │  │ Game Action │  │ Memory Op   │            │
│  │ (INSERT,    │  │ (UP, DOWN,  │  │ (ASSOC,     │            │
│  │  DELETE)    │  │  A, B)      │  │  WRITE)     │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
└─────────────────────────────────────────────────────────────────┘

Key Features:
- Sparse, O(1) memory lookups vs O(n) soft-attention
- Learned symbol extraction vs brittle regex
- Selective gating for efficiency
- Cross-domain generalization (code → games)
- Asynchronous LLM integration
- Recurrence-completeness for unbounded sequences
